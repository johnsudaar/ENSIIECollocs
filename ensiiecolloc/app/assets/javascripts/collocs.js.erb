//= require jquery.nouislider
//= require wnumb/wNumb


$(function(){
  new google.maps.places.Autocomplete($("#colloc_adresse")[0]);
});

function placeAllPoints(){
  for(i=0; i<locations.length; i++) {
    placePoint(locations[i]);
  }
}

function initMap(){
  var bounds = new google.maps.LatLngBounds();
  for(i=0; i<locations.length; i++) {
    bounds.extend(new google.maps.LatLng(locations[i].lat,locations[i].long));
  }

  var center = bounds.getCenter();
  var mapOptions = {
    center:center,
    zoom:13
  }

  map = new google.maps.Map($("#google-map")[0],mapOptions);
  if(locations.length >= 2){
    map.fitBounds(bounds);
    map.panToBounds(bounds);
  }
}

function placePoint(p){
  var lat_ln = new google.maps.LatLng(p.lat,p.long);
  var content_string =  "<h5>"+ p.name+"</h5><br/> Prix : "+p.price+"€/mois <br/> Pour "+p.max_people+"<br/> <a href=\""+p.path+"\">Plus d'informations</a>";
  var infoWindow = new google.maps.InfoWindow({
    content:content_string
  });
  var icon = "<%= asset_path 'marker.png' %>"
  var marker = new google.maps.Marker({
    position: lat_ln,
    map: map,
    icon: icon,
    title: p.name
  });

  google.maps.event.addListener(marker,'click',function(){
    infoWindow.open(map,marker)
  });
}


$(function(){
  Dropzone.options.ajoutPhoto = {
    dictDefaultMessage: "Cliquez ou glissez-déposez vos images ici pour les ajouter.",
    acceptedFiles: "image/*"
  };
  $(".button-delete").click(function(e){
    remove_url = $(this).attr("picture-delete-url");
    $.get( remove_url, function( data ) {
      if(data.success){
        console.log($("#"+data.picture));
        $("#"+data.picture).remove();
        toastr.success(data.message);
      }else{
        toastr.error(data.message);
      }
    });
    e.preventDefault();
  });
});

function setupSearchUI(){
  $("#price").noUiSlider({
    start: [20, 80],
    connect: true,
    range: {
      'min': 0,
      'max': 100
    },
    format: wNumb({
  		decimals: 2,
  		thousand: ' ',
  		postfix: ' €',
  	})
  });

  $("#price").Link('lower').to($("#price-slider-min"));
  $("#price").Link('upper').to($("#price-slider-max"));


  $("#size").noUiSlider({
    start: [20, 80],
    step:1,
    connect: true,
    range: {
      'min': 0,
      'max': 100
    },
    format: wNumb({
  		decimals: 0,
  		thousand: ' ',
  		postfix: ' m²',
  	})
  });

  $("#size").Link('lower').to($("#size-slider-min"));
  $("#size").Link('upper').to($("#size-slider-max"));

  $("#max_people").noUiSlider({
    start: [20, 80],
    step: 1,
    connect: true,
    range: {
      'min': 0,
      'max': 100
    },
    format: wNumb({
  		decimals: 0,
  		thousand: ' ',
  		postfix: '',
  	})
  });

  $("#max_people").Link('lower').to($("#people-slider-min"));
  $("#max_people").Link('upper').to($("#people-slider-max"));

  $("#dist").noUiSlider({
    start: [20],
    step: 1,
    range: {
      'min': 0,
      'max': 100
    },
    format: wNumb({
  		decimals: 0,
  		thousand: ' ',
  		postfix: 'km',
  	})
  });
  $("#dist").Link('lower').to($("#dist-slider"));

  new google.maps.places.Autocomplete($("#start_point")[0]);

}
